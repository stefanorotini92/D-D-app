<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Scheda Personaggio D&D 5e</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cinzel', serif; background: #f4f1ea; margin:0; padding:0; color:#222; }
    h1 { font-family: 'Uncial Antiqua', cursive; text-align:center; margin:20px; font-size:2.2em; }
    .container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; padding: 20px; max-width: 1200px; margin: auto; }
    .box { background:#fff; border:2px solid #000; border-radius:8px; padding:15px; margin-bottom:20px; }
    .box h2 { font-size:1.3em; border-bottom:2px solid #000; padding-bottom:5px; margin-bottom:10px; }
    label { display:block; margin-top:8px; font-weight:bold; }
    input, select, textarea { width:100%; padding:5px; margin-top:3px; border:1px solid #333; border-radius:4px; font-family:inherit; font-size:0.9em; }
    small { display:block; font-weight:normal; color:#555; font-size:0.8em; margin-top:2px; }
    .stats { display:grid; grid-template-columns: repeat(3,1fr); gap:10px; }
    .stat { border:1px solid #000; border-radius:6px; text-align:center; padding:10px; background:#fdfbf7; }
    .stat label { margin:0; font-size:0.9em; }
    .stat input { width:60px; text-align:center; font-size:1.2em; }
    .btn { display:inline-block; margin:10px 5px 0 0; padding:10px 15px; background:#222; color:#fff; border:none; border-radius:5px; cursor:pointer; font-family:inherit; }
    .btn:hover { background:#555; }
    .pg-list { margin-top:20px; }
    .pg-item { border:1px solid #000; border-radius:6px; background:#fafafa; padding:10px; margin-bottom:10px; }
    pre { background:#eee; border:1px solid #ccc; border-radius:6px; padding:10px; max-height:300px; overflow-y:auto; }
  </style>
</head>
<body>
  <h1>Scheda Personaggio D&D 5e</h1>
  <div class="container">

    <!-- Colonna sinistra -->
    <div>
      <div class="box">
        <h2>Dati Base</h2>
        <label>Nome<input type="text" id="name"><small>Il nome del personaggio.</small></label>
        <label>Classe
          <select id="class">
            <option value="">Seleziona</option>
            <option>Guerriero</option><option>Mago</option><option>Ladro</option>
            <option>Chierico</option><option>Barbaro</option><option>Bardo</option>
            <option>Druido</option><option>Paladino</option><option>Monaco</option>
            <option>Ranger</option><option>Stregone</option><option>Warlock</option>
          </select>
          <small>La classe definisce abilità e dadi vita.</small>
        </label>
        <label>Razza
          <select id="race">
            <option value="">Seleziona</option>
            <option>Umano</option><option>Elfo</option><option>Nano</option>
            <option>Halfling</option><option>Gnomo</option><option>Tiefling</option>
            <option>Dragonide</option><option>Mezzorco</option>
          </select>
          <small>La razza influisce su caratteristiche e tratti.</small>
        </label>
        <label>Background<input type="text" id="background"><small>Il passato del PG, utile per competenze extra.</small></label>
        <label>Allineamento
          <select id="alignment">
            <option value="">Seleziona</option>
            <option>Legale Buono</option><option>Neutrale Buono</option><option>Caotico Buono</option>
            <option>Legale Neutrale</option><option>Neutrale</option><option>Caotico Neutrale</option>
            <option>Legale Malvagio</option><option>Neutrale Malvagio</option><option>Caotico Malvagio</option>
          </select>
          <small>Indica etica e comportamento.</small>
        </label>
        <label>Livello<input type="number" id="level" value="1" min="1"><small>Determina potere, competenze e PF.</small></label>
      </div>

      <div class="box">
        <h2>Caratteristiche</h2>
        <div class="stats">
          <div class="stat"><label>Forza</label><input type="number" id="strength" value="10"><small>Attacchi corpo a corpo, peso trasportabile.</small></div>
          <div class="stat"><label>Destrezza</label><input type="number" id="dexterity" value="10"><small>Iniziativa, acrobazie, furtività.</small></div>
          <div class="stat"><label>Costituzione</label><input type="number" id="constitution" value="10"><small>Resistenza e punti ferita.</small></div>
          <div class="stat"><label>Intelligenza</label><input type="number" id="intelligence" value="10"><small>Magia arcana e conoscenze.</small></div>
          <div class="stat"><label>Saggezza</label><input type="number" id="wisdom" value="10"><small>Percezione, intuizione, magia divina.</small></div>
          <div class="stat"><label>Carisma</label><input type="number" id="charisma" value="10"><small>Incantesimi e abilità sociali.</small></div>
        </div>
      </div>
    </div>

    <!-- Colonna destra -->
    <div>
      <div class="box">
        <h2>Combattimento</h2>
        <label>Punti Ferita Massimi<input type="number" id="max_hp" value="10"><small>Il totale dei PF del personaggio.</small></label>
        <label>Punti Ferita Attuali<input type="number" id="current_hp" value="10"><small>I PF rimanenti dopo i danni.</small></label>
        <label>Classe Armatura<input type="number" id="armor_class" value="10"><small>Quanto è difficile colpire il PG.</small></label>
        <label>Iniziativa<input type="number" id="initiative" value="0"><small>Modificatore ai tiri di iniziativa.</small></label>
        <label>Velocità<input type="number" id="speed" value="9"><small>Metri che puoi muoverti a turno.</small></label>
        <label>Dado Vita<input type="text" id="hit_dice" value="1d8"><small>Usato per recuperare PF durante i riposi.</small></label>
      </div>

      <div class="box">
        <h2>Anteprima Scheda</h2>
        <div id="preview"><em>Compila i campi per vedere l’anteprima</em></div>
      </div>

      <div class="box">
        <button class="btn" onclick="saveCharacter()">Salva</button>
        <button class="btn" onclick="randomCharacter()">Genera Casuale</button>
      </div>

      <div class="box">
        <h2>Personaggi Salvati</h2>
        <div class="pg-list" id="pgList"></div>
      </div>
    </div>
  </div>

  <script>
    function getCharacterData(){
      return {
        name: document.getElementById("name").value,
        class: document.getElementById("class").value,
        race: document.getElementById("race").value,
        background: document.getElementById("background").value,
        alignment: document.getElementById("alignment").value,
        level: parseInt(document.getElementById("level").value),
        strength: parseInt(document.getElementById("strength").value),
        dexterity: parseInt(document.getElementById("dexterity").value),
        constitution: parseInt(document.getElementById("constitution").value),
        intelligence: parseInt(document.getElementById("intelligence").value),
        wisdom: parseInt(document.getElementById("wisdom").value),
        charisma: parseInt(document.getElementById("charisma").value),
        max_hp: parseInt(document.getElementById("max_hp").value),
        current_hp: parseInt(document.getElementById("current_hp").value),
        armor_class: parseInt(document.getElementById("armor_class").value),
        initiative: parseInt(document.getElementById("initiative").value),
        speed: parseInt(document.getElementById("speed").value),
        hit_dice: document.getElementById("hit_dice").value
      };
    }

    async function saveCharacter(){
      const char = getCharacterData();
      await fetch("/characters", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(char)
      });
      fetchCharacters();
    }

    async function fetchCharacters(){
      const res = await fetch("/characters");
      const chars = await res.json();
      const list = document.getElementById("pgList");
      list.innerHTML = "";
      chars.forEach(c=>{
        const div = document.createElement("div");
        div.className = "pg-item";
        div.innerHTML = `<strong>${c.name}</strong> (Lv ${c.level} ${c.race} ${c.class})`;
      });
    }

    async function randomCharacter(){
      const res = await fetch("/characters/random");
      const char = await res.json();
      Object.keys(char).forEach(k=>{
        if(document.getElementById(k)){
          document.getElementById(k).value = char[k];
        }
      });
      updatePreview();
    }

    function updatePreview(){
      const char = getCharacterData();
      char.str_mod = Math.floor((char.strength-10)/2);
      char.dex_mod = Math.floor((char.dexterity-10)/2);
      char.con_mod = Math.floor((char.constitution-10)/2);
      char.int_mod = Math.floor((char.intelligence-10)/2);
      char.wis_mod = Math.floor((char.wisdom-10)/2);
      char.cha_mod = Math.floor((char.charisma-10)/2);
      document.getElementById("preview").innerHTML = `<pre>${JSON.stringify(char,null,2)}</pre>`;
    }

    document.querySelectorAll("input,select").forEach(el=>{
      el.addEventListener("input", updatePreview);
    });

    fetchCharacters();
  </script>
</body>
</html>
